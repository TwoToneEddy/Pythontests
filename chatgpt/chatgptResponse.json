{
    "id": "chatcmpl-707AdZukVsupEAKcVNpao22s3MU4s",
    "object": "chat.completion",
    "created": 1680261919,
    "model": "gpt-3.5-turbo-0301",
    "usage": {
        "prompt_tokens": 348,
        "completion_tokens": 3431,
        "total_tokens": 3779
    },
    "choices": [
        {
            "message": {
                "role": "assistant",
                "content": "[  \n   {  \n      \"id\":\"c77dc100.edd6a\",\n      \"type\":\"inject\",\n      \"z\":\"627e2ef7.661bac\",\n      \"name\":\"\",\n      \"props\":[  \n         {  \n            \"p\":\"payload\"\n         }\n      ],\n      \"repeat\":\"\",\n      \"crontab\":\"\",\n      \"once\":false,\n      \"onceDelay\":0.1,\n      \"topic\":\"\",\n      \"payload\":\"\",\n      \"payloadType\":\"date\",\n      \"x\":120,\n      \"y\":240,\n      \"wires\":[  \n         [  \n            \"9a5bbeb3.7d40f8\"\n         ]\n      ]\n   },\n   {  \n      \"id\":\"9a5bbeb3.7d40f8\",\n      \"type\":\"function\",\n      \"z\":\"627e2ef7.661bac\",\n      \"name\":\"Set Parameters\",\n      \"func\":\"// Set user-defined parameters\\nlet end_voltage = 10; \\nlet max_current = 1.5; \\nmsg.payload = { end_voltage, max_current };\\nreturn msg;\",\n      \"outputs\":1,\n      \"noerr\":0,\n      \"x\":320,\n      \"y\":240,\n      \"wires\":[  \n         [  \n            \"6a089d6d.7ecbe8\"\n         ]\n      ]\n   },\n   {  \n      \"id\":\"6a089d6d.7ecbe8\",\n      \"type\":\"ui_template\",\n      \"z\":\"627e2ef7.661bac\",\n      \"group\":\"16dd910f.50d606\",\n      \"name\":\"Battery Tester\",\n      \"order\":0,\n      \"width\":\"6\",\n      \"height\":\"6\",\n      \"format\":\"<div>\\n  <h4>Battery Tester</h4>\\n  <p>End Voltage: {{end_voltage}} V</p>\\n  <p>Max Current: {{max_current}} A</p>\\n  <button ng-click=\\\"send({payload: true})\\\">Start Test</button>\\n\\n  <p>Current: {{current}} A</p>\\n  <p>Voltage: {{voltage}} V</p>\\n  <p>Power: {{power}} W</p>\\n  <p>Amp Hours: {{amp_hours}} Ah</p>\\n  <p>Watt Hours: {{watt_hours}} Wh</p>\\n</div>\\n<script>\\n\\ngauges = [];\\n\\n// Set up gauges\\nvar current_gauge = new JustGage({\\n  id: \\\"current_gauge\\\",\\n  value: 0,\\n  min: 0,\\n  max: 2,\\n  title: \\\"Current (A)\\\"\\n});\\n\\nvar voltage_gauge = new JustGage({\\n  id: \\\"voltage_gauge\\\",\\n  value: 0,\\n  min: 0,\\n  max: 20,\\n  title: \\\"Voltage (V)\\\"\\n});\\n\\nvar power_gauge = new JustGage({\\n  id: \\\"power_gauge\\\",\\n  value: 0,\\n  min: 0,\\n  max: 30,\\n  title: \\\"Power (W)\\\"\\n});\\n\\nvar amp_hours_gauge = new JustGage({\\n  id: \\\"amp_hours_gauge\\\",\\n  value: 0,\\n  min: 0,\\n  max: 2,\\n  title: \\\"Amp Hours (Ah)\\\"\\n});\\n\\nvar watt_hours_gauge = new JustGage({\\n  id: \\\"watt_hours_gauge\\\",\\n  value: 0,\\n  min: 0,\\n  max: 30,\\n  title: \\\"Watt Hours (Wh)\\\"\\n});\\n\\ngauges.push(current_gauge);\\n\\n// Get DOM elements\\nvar current_element = document.querySelector('#current_gauge .js-value');\\nvar voltage_element = document.querySelector('#voltage_gauge .js-value');\\nvar power_element = document.querySelector('#power_gauge .js-value');\\nvar amp_hours_element = document.querySelector('#amp_hours_gauge .js-value');\\nvar watt_hours_element = document.querySelector('#watt_hours_gauge .js-value');\\n\\n// Update values every second\\nsetInterval(function() {\\n    current_element.innerHTML = current_gauge.config.value;\\n    voltage_element.innerHTML = voltage_gauge.config.value;\\n    power_element.innerHTML = power_gauge.config.value;\\n    amp_hours_element.innerHTML = amp_hours_gauge.config.value;\\n    watt_hours_element.innerHTML = watt_hours_gauge.config.value;\\n}, 1000);\\n\\n// Listen for start test button\\ndefineWidget(\\\"BatteryTester\\\", \\\"ui_widget\\\", {\\n    onPreRender: function() {\\n        this.scope.$watch('msg.payload', function(newValue, oldValue) {\\n            if (newValue === true) {\\n                // Start test\\n                node.send({payload: true});\\n            }\\n        });\\n    }\\n});\\n\\n</script>\\n\",\n      \"storeOutMessages\":true,\n      \"fwdInMessages\":true,\n      \"templateScope\":\"local\",\n      \"x\":540,\n      \"y\":240,\n      \"wires\":[  \n         [  \n            \"6b50a28d.23d164\"\n         ]\n      ]\n   },\n   {  \n      \"id\":\"6b50a28d.23d164\",\n      \"type\":\"change\",\n      \"z\":\"627e2ef7.661bac\",\n      \"name\":\"Set GPIO\",\n      \"rules\":[  \n         {  \n            \"t\":\"set\",\n            \"p\":\"payload\",\n            \"pt\":\"msg\",\n            \"to\":\"1\",\n            \"tot\":\"str\"\n         },\n         {  \n            \"t\":\"set\",\n            \"p\":\"topic\",\n            \"pt\":\"msg\",\n            \"to\":\"gpio/27\",\n            \"tot\":\"str\"\n         }\n      ],\n      \"action\":\"\",\n      \"property\":\"\",\n      \"from\":\"\",\n      \"to\":\"\",\n      \"reg\":false,\n      \"x\":720,\n      \"y\":240,\n      \"wires\":[  \n         [  \n            \"4d0fd5ee.101cf8\"\n         ]\n      ]\n   },\n   {  \n      \"id\":\"4d0fd5ee.101cf8\",\n      \"type\":\"function\",\n      \"z\":\"627e2ef7.661bac\",\n      \"name\":\"Battery Test\",\n      \"func\":\"let end_voltage = context.get('end_voltage') || 0;\\nlet max_current = context.get('max_current') || 0;\\nlet start_time = context.get('start_time') || 0;\\nlet current = 0;\\nlet voltage = 0;\\nlet power = 0;\\nlet amp_hours = 0;\\nlet watt_hours = 0;\\n\\n// Calculate duty cycle\\nlet duty_cycle = 0;\\nif (current <= max_current) {\\n    // Current control mode\\n    duty_cycle = current / max_current;\\n} else if (voltage > (end_voltage - 0.5)) {\\n    // Voltage control mode\\n    duty_cycle = (voltage - end_voltage) / voltage;\\n}\\n\\n// Send PWM signal to mosfet\\nmsg.payload = { cycle: duty_cycle };\\nmsg.topic = 'pwm/13';\\nnode.send(msg);\\n\\n// Get ADC values\\nmsg.payload = { command: 'read', channel: 0 };\\nmsg.topic = 'adc/mcp3424';\\nnode.send(msg);\\n\\nmsg.payload = { command: 'read', channel: 1 };\\nmsg.topic = 'adc/mcp3424';\\nnode.send(msg);\\n\\n// Calculate values\\nlet elapsed_time = new Date().getTime() - start_time;\\ncurrent = msg.payload[1];\\nvoltage = msg.payload[0];\\npower = current * voltage;\\namp_hours = (current * elapsed_time) / (1000 * 60 * 60);\\nwatt_hours = (power * elapsed_time) / (1000 * 60 * 60);\\n\\n// Update context\\ncontext.set('end_voltage', end_voltage);\\ncontext.set('max_current', max_current);\\ncontext.set('start_time', start_time);\\n\\n// Update UI\\nmsg.ui_control = {\\n    current,\\n    voltage,\\n    power,\\n    amp_hours,\\n    watt_hours\\n};\\n\\nreturn msg;\",\n      \"outputs\":1,\n      \"noerr\":0,\n      \"x\":920,\n      \"y\":240,\n      \"wires\":[  \n         [  \n            \"15a9fbde.50da73\"\n         ],\n         [  \n            \"70590eb.29ee6d\"\n         ],\n         [  \n            \"aad42fb0.0efae\"\n         ],\n         [  \n            \"f49cc7c0.5105d8\"\n         ]\n      ]\n   },\n   {  \n      \"id\":\"15a9fbde.50da73\",\n      \"type\":\"change\",\n      \"z\":\"627e2ef7.661bac\",\n      \"name\":\"Set Current Gauge\",\n      \"rules\":[  \n         {  \n            \"t\":\"set\",\n            \"p\":\"payload\",\n            \"pt\":\"msg\",\n            \"to\":\"ui_control.current\",\n            \"tot\":\"msg\"\n         }\n      ],\n      \"action\":\"\",\n      \"property\":\"\",\n      \"from\":\"\",\n      \"to\":\"\",\n      \"reg\":false,\n      \"x\":1170,\n      \"y\":140,\n      \"wires\":[  \n         [  \n            \"1f9b5012.722066\"\n         ]\n      ]\n   },\n   {  \n      \"id\":\"70590eb.29ee6d\",\n      \"type\":\"change\",\n      \"z\":\"627e2ef7.661bac\",\n      \"name\":\"Set Voltage Gauge\",\n      \"rules\":[  \n         {  \n            \"t\":\"set\",\n            \"p\":\"payload\",\n            \"pt\":\"msg\",\n            \"to\":\"ui_control.voltage\",\n            \"tot\":\"msg\"\n         }\n      ],\n      \"action\":\"\",\n      \"property\":\"\",\n      \"from\":\"\",\n      \"to\":\"\",\n      \"reg\":false,\n      \"x\":1170,\n      \"y\":200,\n      \"wires\":[  \n         [  \n            \"882431d2.ba7a48\"\n         ]\n      ]\n   },\n   {  \n      \"id\":\"aad42fb0.0efae\",\n      \"type\":\"change\",\n      \"z\":\"627e2ef7.661bac\",\n      \"name\":\"Set Power Gauge\",\n      \"rules\":[  \n         {  \n            \"t\":\"set\",\n            \"p\":\"payload\",\n            \"pt\":\"msg\",\n            \"to\":\"ui_control.power\",\n            \"tot\":\"msg\"\n         }\n      ],\n      \"action\":\"\",\n      \"property\":\"\",\n      \"from\":\"\",\n      \"to\":\"\",\n      \"reg\":false,\n      \"x\":1170,\n      \"y\":260,\n      \"wires\":[  \n         [  \n            \"9996d8b6.ba2328\"\n         ]\n      ]\n   },\n   {  \n      \"id\":\"f49cc7c0.5105d8\",\n      \"type\":\"change\",\n      \"z\":\"627e2ef7.661bac\",\n      \"name\":\"Set Amp Hours Gauge\",\n      \"rules\":[  \n         {  \n            \"t\":\"set\",\n            \"p\":\"payload\",\n            \"pt\":\"msg\",\n            \"to\":\"ui_control.amp_hours\",\n            \"tot\":\"msg\"\n         }\n      ],\n      \"action\":\"\",\n      \"property\":\"\",\n      \"from\":\"\",\n      \"to\":\"\",\n      \"reg\":false,\n      \"x\":1210,\n      \"y\":320,\n      \"wires\":[  \n         [  \n            \"e07d060d.25a54\"\n         ]\n      ]\n   },\n   {  \n      \"id\":\"1f9b5012.722066\",\n      \"type\":\"ui_gauge\",\n      \"z\":\"627e2ef7.661bac\",\n      \"name\":\"\",\n      \"group\":\"16dd910f.50d606\",\n      \"order\":1,\n      \"width\":\"4\",\n      \"height\":\"4\",\n      \"gtype\":\"gage\",\n      \"title\":\"Current (A)\",\n      \"label\":\"A\",\n      \"format\":\"{{value}}\",\n      \"min\":\"0\",\n      \"max\":\"2\",\n      \"colors\":[  \n         \"#00b500\",\n         \"#e6e600\",\n         \"#ca3838\"\n      ],\n      \"seg1\":\"1\",\n      \"seg2\":\"1.5\",\n      \"x\":1340,\n      \"y\":140,\n      \"wires\":[ ]\n   },\n   {  \n      \"id\":\"882431d2.ba7a48\",\n      \"type\":\"ui_gauge\",\n      \"z\":\"627e2ef7.661bac\",\n      \"name\":\"\",\n      \"group\":\"16dd910f.50d606\",\n      \"order\":2,\n      \"width\":\"4\",\n      \"height\":\"4\",\n      \"gtype\":\"gage\",\n      \"title\":\"Voltage (V)\",\n      \"label\":\"V\",\n      \"format\":\"{{value}}\",\n      \"min\":\"0\",\n      \"max\":\"20\",\n      \"colors\":[  \n         \"#ca3838\",\n         \"#e6e600\",\n         \"#00b500\"\n      ],\n      \"seg1\":\"10\",\n      \"seg2\":\"14\",\n      \"x\":1340,\n      \"y\":200,\n      \"wires\":[ ]\n   },\n   {  \n      \"id\":\"9996d8b6.ba2328\",\n      \"type\":\"ui_gauge\",\n      \"z\":\"627e2ef7.661bac\",\n      \"name\":\"\",\n      \"group\":\"16dd910f.50d606\",\n      \"order\":3,\n      \"width\":\"4\",\n      \"height\":\"4\",\n      \"gtype\":\"gage\",\n      \"title\":\"Power (W)\",\n      \"label\":\"W\",\n      \"format\":\"{{value}}\",\n      \"min\":\"0\",\n      \"max\":\"30\",\n      \"colors\":[  \n         \"#00b500\",\n         \"#e6e600\",\n         \"#ca3838\"\n      ],\n      \"seg1\":\"10\",\n      \"seg2\":\"20\",\n      \"x\":1340,\n      \"y\":260,\n      \"wires\":[ ]\n   },\n   {  \n      \"id\":\"e07d060d.25a54\",\n      \"type\":\"ui_gauge\",\n      \"z\":\"627e2ef7.661bac\",\n      \"name\":\"\",\n      \"group\":\"16dd910f.50d606\",\n      \"order\":4,\n      \"width\":\"4\",\n      \"height\":\"4\",\n      \"gtype\":\"gage\",\n      \"title\":\"Amp Hours (Ah)\",\n      \"label\":\"Ah\",\n      \"format\":\"{{value}}\",\n      \"min\":\"0\",\n      \"max\":\"2\",\n      \"colors\":[  \n         \"#00b500\",\n         \"#e6e600\",\n         \"#ca3838\"\n      ],\n      \"seg1\":\"1\",\n      \"seg2\":\"1.5\",\n      \"x\":1340,\n      \"y\":320,\n      \"wires\":[ ]\n   },\n   {  \n      \"id\":\"16dd910f.50d606\",\n      \"type\":\"ui_group\",\n      \"name\":\"Battery Tester\",\n      \"tab\":\"a51e757.f166db8\",\n      \"order\":4,\n      \"disp\":true,\n      \"width\":\"12\",\n      \"collapse\":true\n   },\n   {  \n      \"id\":\"a51e757f.f166db8\",\n      \"type\":\"ui_tab\",\n      \"name\":\"Home\",\n      \"icon\":\"dashboard\",\n      \"order\":1\n   }\n]\n\nPlease note: this is only an example, and the actual flow configuration may vary depending on the specific hardware and software setup. Always refer to the relevant documentation and user guides when working with electronic devices."
            },
            "finish_reason": "stop",
            "index": 0
        }
    ]
}